(define (make-movingobject position orientation kind)
  (let ((previous-orientation orientation))

    (define (position! new-position-object)
      (set! position new-position-object))

    (define (change-orientation! orientation)
        (cond
          ((eq? orientation 'right) (orientation! 'left))
          ((eq? orientation 'left) (orientation! 'right))
          ((eq? orientation 'up) (orientation! 'down))
          ((eq? orientation 'down) (orientation! 'up))))

    (define (orientation! new-orientation)
      (set! orientation new-orientation))

    (define (previous-orientation! given-orientation)
      (set! previous-orientation given-orientation))
    
    (define (move! distance)
      (cond
        ((eq? orientation 'right) (position! (make-position (+ (position 'x) distance) (position 'y))))
        ((eq? orientation 'left) (position! (make-position (- (position 'x) distance) (position 'y))))
        ((eq? orientation 'up) (position! (make-position (position 'x) (- (position 'y) distance))))
        ((eq? orientation 'down) (position! (make-position (position 'x) (+ (position 'y) distance))))))

    (define (dispatch m)
      (cond
        ((eq? m 'position) position)
        ((eq? m 'position!) position!)
        ((eq? m 'orientation) orientation)
        ((eq? m 'orientation!) orientation!)
        ((eq? m 'change-orientation!) change-orientation!)
        ((eq? m 'previous-orientation) previous-orientation)
        ((eq? m 'previous-orientation!) previous-orientation!)
        ((eq? m 'kind) kind)
        ((eq? m 'move!) move!)
        (else  (error "[ERROR in MovingObjectADT DISPATCH] Wrong message: ") (display m))))
    dispatch))
